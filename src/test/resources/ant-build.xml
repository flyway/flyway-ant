<project name="FlywayAntPluginTest" xmlns:flyway="antlib:org.flywaydb.ant">

    <path id="flyway.lib.path"/><!-- flyway and h2 libs already on the classpath -->

    <taskdef uri="antlib:org.flywaydb.ant" resource="org/flywaydb/ant/antlib.xml"
             classpathref="flyway.lib.path"/>

    <target name="migrate-test" depends="-set-parameters">
        <flyway:migrate/>
    </target>

    <target name="clean-test" depends="-set-parameters">
        <flyway:clean/>
    </target>

    <target name="info-test" depends="-set-parameters">
        <flyway:info/>
    </target>

    <target name="validate-test" depends="-set-parameters">
        <flyway:migrate/>
        <flyway:validate/>
    </target>

    <target name="baseline-test" depends="-set-parameters">
        <flyway:baseline/>
    </target>

    <target name="repair-test" depends="-set-parameters">
        <flyway:repair/>
    </target>

    <target name="-check-db">
        <fail message="Property 'db' must be set.">
            <condition>
                <not>
                    <isset property="db"/>
                </not>
            </condition>
        </fail>
    </target>

    <target name="-set-parameters" depends="-check-db">
        <property name="flyway.url" value="jdbc:h2:${db}"/>
        <property name="flyway.user" value="sa"/>
        <property name="flyway.password" value=""/>
    </target>

</project>